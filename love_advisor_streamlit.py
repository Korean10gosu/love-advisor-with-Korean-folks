# love_advisor_streamlit.py

import os
import json
import streamlit as st
from dotenv import load_dotenv
import openai

# -----------------------
# OpenAI API ì„¤ì •
# -----------------------
load_dotenv()  # .env íŒŒì¼ ì½ê¸°
client = openai.OpenAI(api_key=os.getenv("OPENAI_API_KEY"))
# -----------------------
# ê³ ì „ ì‘í’ˆ ë°ì´í„° (app.py ê¸°ì¤€ ì „ì²´ í¬í•¨)
# -----------------------
classic_love_db = {
    "ì§ì‚¬ë‘": [
        {
            "title": "ì´ìƒê·œì¥ì „",
            "problem": "ì´ìƒì€ ì†¡ë„ì— ì‚´ë©° í•™ë‹¹ì— ë‹¤ë‹ˆë‹¤ ìµœì”¨ ê·œìˆ˜ë¥¼ ë³´ê³  ì‚¬ëª¨í•˜ì§€ë§Œ, ì‹ ë¶„ê³¼ ì˜ˆë²• ë•Œë¬¸ì— ë§ˆìŒì„ í‘œí˜„í•˜ì§€ ëª»í•¨.",
            "solution": "ë‘ë ¤ì›€ì„ ê·¹ë³µí•˜ê³  ì§ì ‘ ë§ˆìŒì„ ì „í•¨. ìƒëŒ€ë„ ê°™ì€ ë§ˆìŒì„ì„ í™•ì¸í•˜ê³  ë¶€ëª¨ì˜ í—ˆë½ì„ ë°›ì•„ í˜¼ì¸í•¨.",
            "lesson": "í‘œí˜„í•˜ì§€ ì•Šìœ¼ë©´ ê¸°íšŒë¥¼ ë†“ì¹  ìˆ˜ ìˆìœ¼ë©°, ì†”ì§í•˜ê²Œ ë§ˆìŒì„ ì „í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•¨.",
            "advice": "ìš©ê¸°ë¥¼ ë‚´ì–´ ë§ˆìŒì„ ì†”ì§íˆ í‘œí˜„í•˜ë¼. ê·¸ë˜ì•¼ ì§„ì •í•œ ì‚¬ë‘ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤."
        },
        {
            "title": "ë§Œë³µì‚¬ì €í¬ê¸°",
            "problem": "ì–‘ìƒì€ ë§Œë³µì‚¬ì—ì„œ ì£½ì€ ì²˜ë…€ì˜ í˜¼ë ¹ê³¼ ì‚¬ë‘ì— ë¹ ì§€ì§€ë§Œ í˜„ì‹¤ì ìœ¼ë¡œ ì´ë£° ìˆ˜ ì—†ìŒ.",
            "solution": "ì €ìŠ¹ì‚¬ìì™€ ì €í¬ ë†€ì´ì—ì„œ ìŠ¹ë¦¬í•´ í•œ í•˜ë£»ë°¤ì„ ë³´ë‚´ì§€ë§Œ ê²°êµ­ ì—¬ì¸ì€ ì‚¬ë¼ì§. ì–‘ìƒì€ ì„¸ì†ì„ ë– ë‚˜ ê¸ˆê°•ì‚°ìœ¼ë¡œ ë“¤ì–´ê°.",
            "lesson": "ì´ë£° ìˆ˜ ì—†ëŠ” ì‚¬ë‘ì€ ì§‘ì°©í•˜ì§€ ì•Šê³  ë°›ì•„ë“¤ì´ë©° ì´ˆì›”ì ìœ¼ë¡œ ìŠ¹í™”í•  ìˆ˜ ìˆì–´ì•¼ í•¨.",
            "advice": "ë§ˆìŒì„ ì–µì§€ë¡œ ë¶™ì¡ì§€ ë§ê³ , ì•„ë¦„ë‹µê²Œ ê°„ì§í•˜ë©° ë§ˆìŒì„ ì •í™”í•˜ë¼."
        }
    ],
    "ì™¸ë¶€ ë°©í•´": [
        {
            "title": "ìˆ™í–¥ì „",
            "problem": "ì™¸ë¶€ì˜ ìœ í˜¹ê³¼ ì‹œë ¨ ì†ì—ì„œë„ ì„œë¡œë¥¼ ë¯¿ê³  ì‹ ë¢°ë¥¼ ì§€ì¼œì•¼ í•˜ëŠ” ìƒí™©.",
            "solution": "ì„œë¡œë¥¼ ì˜ì‹¬í•˜ì§€ ì•Šê³  êµ³ê±´í•œ ë¯¿ìŒìœ¼ë¡œ ì‹œë ¨ì„ ì´ê²¨ëƒ„.",
            "lesson": "ì™¸ë¶€ì˜ ë°©í•´ë‚˜ ì˜¤í•´ì—ë„ ì„œë¡œë¥¼ ë¯¿ìœ¼ë©´ ê·¹ë³µ ê°€ëŠ¥.",
            "advice": "ìƒëŒ€ë°©ì„ ë¯¿ê³  í”ë“¤ë¦¬ì§€ ë§ë¼."
        }
    ],
    "ì´ë³„ í›„ ì¬íšŒ": [
        {
            "title": "ìµœì²™ì „",
            "problem": "ì „ìŸìœ¼ë¡œ í—¤ì–´ì§„ ë¶€ë¶€ê°€ ì„œë¡œë¥¼ ì°¾ì•„ ê³ ë‚œì„ ê²ªëŠ” ìƒí™©.",
            "solution": "ìˆ˜ì‹­ ë…„ê°„ ì„œë¡œë¥¼ ì°¾ì•„ í—¤ë§¤ë‹¤ ê·¹ì ìœ¼ë¡œ ì¬íšŒí•¨.",
            "lesson": "ì§„ì •í•œ ì‚¬ë‘ì€ ì‹œê°„ê³¼ ê±°ë¦¬ë¥¼ ì´ˆì›”í•¨.",
            "advice": "í¬ê¸°í•˜ì§€ ë§ê³  ì§„ì‹¬ì„ ì§€ì¼œë¼."
        }
    ],
    "ì‚¼ê°ê´€ê³„": [
        {
            "title": "ì£¼ìƒì „",
            "problem": "ì£¼ìƒì´ ë°°ë„ì™€ ì‚¬ë‘í•˜ì§€ë§Œ, ë¶€ëª¨ê°€ ë‹¤ë¥¸ ê·œìˆ˜ì™€ í˜¼ì¸ì„ ì¶”ì§„í•¨.",
            "solution": "ì‹ ë¶„ ë¬¸ì œì™€ ê°ˆë“± ì†ì—ì„œ ë³‘ë“¦.",
            "lesson": "ìš°ìœ ë¶€ë‹¨ì€ ëª¨ë‘ë¥¼ ë¶ˆí–‰í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŒ.",
            "advice": "ëª…í™•í•œ ì„ íƒê³¼ ì±…ì„ì„ ê°€ì ¸ë¼."
        }
    ],
    "ì¢‹ì•„í•˜ë©´ ì•ˆ ë˜ëŠ” ì‚¬ëŒ": [
        {
            "title": "ìš´ì˜ì „",
            "problem": "ê¶ë…€ê°€ ì‚¬ë‘í•  ìˆ˜ ì—†ëŠ” ì‚¬ëŒê³¼ ë§ˆìŒì´ í†µí•¨.",
            "solution": "ëª°ë˜ ë§Œë‚¬ì§€ë§Œ ë°œê°ë˜ì–´ ì‚¬í˜•.",
            "lesson": "ê¸ˆê¸°ë‚˜ ì œì•½ì€ ë¬´ì‹œí•  ìˆ˜ ì—†ìŒ.",
            "advice": "ì‚¬íšŒì  ìƒí™©ê³¼ ì±…ì„ì„ ë°˜ë“œì‹œ ê³ ë ¤í•˜ë¼."
        }
    ],
    "ì´ë³„ë¡œ í˜ë“  ìƒí™©": [
        {
            "title": "ì†ë¯¸ì¸ê³¡",
            "problem": "ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒê³¼ ì´ë³„í•˜ì—¬ í˜ë“¤ì–´í•¨.",
            "solution": "ì¹œêµ¬ì™€ ê³ ë¯¼ì„ ë‚˜ëˆ„ë©° ìì¡´ê°ì„ ì§€í‚´.",
            "lesson": "ìì‹ ì„ íƒ“í•˜ì§€ ì•Šê³  ê°ê´€ì ìœ¼ë¡œ ìƒí™©ì„ ë°›ì•„ë“¤ì´ê¸°.",
            "advice": "ì£¼ë³€ì˜ ë„ì›€ê³¼ ìê¸° ì¡´ì¤‘ìœ¼ë¡œ ë§ˆìŒì„ ì§€ì¼œë¼."
        }
    ],
    "ì—°ì• ë¡œ ì‚¶ì— ì†Œí™€": [
        {
            "title": "ê²¬ìš°ì™€ ì§ë…€",
            "problem": "ì‚¬ë‘ ë•Œë¬¸ì— ë³¸ì—…ì„ ì†Œí™€íˆ í•¨.",
            "solution": "ë§Œë‚˜ëŠ” ë‚ ê³¼ ì¼ì„ ì¡°ì •í•˜ë©° ê· í˜• ìœ ì§€.",
            "lesson": "ìì‹ ì„ í•´ì¹˜ëŠ” ì‚¬ë‘ì€ í”¼í•˜ê³  ì‚¬ë‘ê³¼ ì‚¶ ì‚¬ì´ì˜ ê· í˜•ì„ ìœ ì§€í•´ì•¼.",
            "advice": "ê· í˜•ì„ ì§€í‚¤ë©° ì‚¬ë‘í•˜ë¼."
        }
    ],
    "ì—°ì• ì™€ ì¼ ëª¨ë‘": [
        {
            "title": "êµ¬ìš´ëª½",
            "problem": "ì—°ì• ë„, ì¼ë„ ë‹¤ ì˜í•˜ê³  ì‹¶ì€ ìƒí™©.",
            "solution": "ê¿ˆì—ì„œ ê¹¨ì–´ ìš•ë§ì˜ ë§ì—†ìŒì„ ê¹¨ë‹«ê³  ë¶ˆë²•ì˜ ê¸¸ë¡œ ëŒì•„ê°.",
            "lesson": "ì§„ì •í•œ ê¹¨ë‹¬ìŒì€ ìš•ë§ì˜ ì´ˆì›”ì— ìˆìŒ.",
            "advice": "ì‚¬ë‘ê³¼ ìš•ë§ì— íœ˜ë‘˜ë¦¬ì§€ ë§ê³  ë³¸ì§ˆì„ ë³´ë¼."
        },
        {
            "title": "ìˆ™ì˜ë‚­ìì „",
            "problem": "ìƒëŒ€ì™€ ì‚¬íšŒì , ê²½ì œì  ì°¨ì´ë¡œ ê³ ë¯¼.",
            "solution": "ê³ ë‚œ ì†ì—ì„œë„ í—Œì‹ ê³¼ ì‹ ì˜ë¥¼ ì§€í‚´.",
            "lesson": "ì§„ì •í•œ ì‚¬ë‘ì€ í—Œì‹ ê³¼ ì¸ë‚´ë¡œ ì§€ì¼œì§.",
            "advice": "ì‹ ë¢°ì™€ í—Œì‹ ìœ¼ë¡œ ì‚¬ë‘ì„ ì§€ì¼œë¼."
        }
    ],
    "ì—°ì•  ì¤‘ ë‹¤ë¥¸ ì‚¬ëŒ": [
        {
            "title": "ë°°ë¹„ì¥ì „",
            "problem": "ì—°ì¸ì´ ìˆëŠ”ë° ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ë§ˆìŒì´ ì›€ì§ì„.",
            "solution": "í—ˆìœ„ì™€ ìœ„ì„ ì´ ë“œëŸ¬ë‚˜ ì¡°ë¡±ë‹¹í•˜ë©° ìì‹ ì˜ ë§Œí–‰ì„ ëŒì•„ë³´ê²Œ ë¨.",
            "lesson": "ë¬´ì—‡ì´ ì˜¬ë°”ë¥¸ ì¼ì¸ì§€ í•­ìƒ ê³ ë¯¼í•˜ë©° ìˆ¨ê²¨ì•¼ í•  ë§ˆìŒì€ ì• ì´ˆì— ê°–ì§€ ë§ˆë¼.",
            "advice": "ìì‹ ì˜ ìƒí™©ì„ ê°ê´€ì ìœ¼ë¡œ ëŒì•„ë³´ê³  ë°˜ì„±í•˜ë©° ì†”ì§í•˜ê²Œ ì´ì•¼ê¸°í•˜ë¼."
        }
    ],
    "ë‹¤ë¥¸ ì‚¬ëŒ ë°©í•´": [
        {
            "title": "ì‚¬ì”¨ë‚¨ì •ê¸°",
            "problem": "ê°„ì‹ ê³¼ ì²©ì˜ ëª¨í•¨ìœ¼ë¡œ ì‚¬ë‘ì´ ì¢Œì ˆë¨.",
            "solution": "ë•ì„ ìŒ“ì•„ ì˜¬ë°”ë¥¸ í–‰ë™ìœ¼ë¡œ ëˆ„ëª…ì„ ë²—ìŒ.",
            "lesson": "ì˜¬ë°”ë¥¸ ë§ˆìŒê³¼ í–‰ë™ì´ ê²°êµ­ ì¸ì •ë°›ìŒ.",
            "advice": "ìì‹ ì˜ ë•ê³¼ ì˜¬ë°”ë¦„ì„ ì§€ì¼œë¼."
        }
    ]
}

# -----------------------
# ìƒë‹´ í•¨ìˆ˜
# -----------------------
def get_advice(user_input: str) -> str:
    system_prompt = f"""
    ë‹¹ì‹ ì€ í•œêµ­ ê³ ì „ë¬¸í•™ ê¸°ë°˜ ì—°ì•  ìƒë‹´ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.ë‹µë³€ì€ ë°ì´í„° ì™¸ ì •ë³´ë¥¼ í¬í•¨í•˜ë©´ ì•ˆë©ë‹ˆë‹¤. ì‘í’ˆ ì •ë³´ì—ëŠ” ì‘ê°€ê°€ ì—†ìœ¼ë©´, ì‘ê°€ë¥¼ ë§Œë“¤ì–´ë‚´ì§€ ë§ê³  ìƒëµí•˜ì„¸ìš”.
    ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì—°ì•  ê³ ë¯¼ì„ ë°”íƒ•ìœ¼ë¡œ, ê´€ë ¨ ê³ ì „ ì‘í’ˆì„ ì¶”ì²œí•˜ê³ 
    ê³ ì „ ì‘í’ˆì—ì„œ ë‚˜íƒ€ë‚œ ë¬¸ì œìƒí™©, í•´ê²° ê³¼ì •, êµí›ˆ, ê³ ì „ ì‘í’ˆê³¼ ì‚¬ìš©ìì˜ ìƒí™©ì„ ê³ ë ¤í•œ í˜„ëŒ€ì  ì¡°ì–¸ì„
    ì™„ê²°ëœ í•˜ë‚˜ì˜ ê¸€ë¡œ êµ¬ì²´ì ìœ¼ë¡œ ì œì‹œí•œ ë’¤
    ì‘í’ˆ ì† ì£¼ì¸ê³µì´ ì‚¬ìš©ìì—ê²Œ í•´ì¤„ ë§Œí•œ 1ì¤„ ì¡°ì–¸ì„ ì œì‹œí•´ì£¼ì„¸ìš”.
    í•œ ì¤„ ì¡°ì–¸ì€ ì£¼ì¸ê³µì´ë¦„: ì¡°ì–¸ ë‚´ìš© í˜•ì‹ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.
    ì—°ì•  ê´€ë ¨ ê³ ë¯¼ì´ ì•„ë‹ˆë©´ "ì—°ì•  ê´€ë ¨ ê³ ë¯¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”."ë¼ê³  ë‹µë³€í•˜ì„¸ìš”.
    ë°ì´í„°: {json.dumps(classic_love_db, ensure_ascii=False)}
    ì‚¬ìš©ì ê³ ë¯¼: {user_input}
    """
    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "system", "content": system_prompt}],
        temperature=0.7,
        max_tokens=800
    )
    return response.choices[0].message.content

# -----------------------
# Streamlit UI
# -----------------------
st.set_page_config(page_title="ğŸ’Œ í•œêµ­ ê³ ì „ë¬¸í•™ ì—°ì•  ìƒë‹´", page_icon="ğŸ’Œ")
st.title("ğŸ’Œ í•œêµ­ ê³ ì „ë¬¸í•™ ì—°ì•  ìƒë‹´ í”„ë¡œê·¸ë¨")

user_input = st.text_input("ì—°ì•  ê³ ë¯¼ì„ ì…ë ¥í•˜ì„¸ìš”...")

if st.button("ìƒë‹´ ë°›ê¸°") and user_input.strip():
    with st.spinner("ê³ ë¯¼ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤..."):
        advice = get_advice(user_input)
    st.subheader("ğŸ“ ìƒë‹´ ê²°ê³¼:")
    st.write(advice)
